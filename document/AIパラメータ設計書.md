# 大富豪AIロジック & 評価関数仕様書 (v1.0)

## 1. 概要

本システムでは、キャラクターごとに設定された「5つの性格パラメータ」を用いて、局面ごとの手の評価（スコアリング）を行い、行動を決定する。
基本的なAIの思考プロセスは以下の通りである。

1. **合法手の列挙**: 現在のルール（場に出ているカード、縛りなど）に基づき、出せるカードの組み合わせ（パス含む）を全てリストアップする。
2. **スコアリング**: 各候補手に対して評価関数を用いてスコアを算出する。
3. **ゆらぎと選択**: パラメータに基づくランダム性を加味し、最終的な手を決定する。

## 2. 性格パラメータ定義 (Character Traits)

各キャラクターは以下の5つのパラメータ（0.0 ～ 1.0 の範囲）を持つ。

| **パラメータ名** | **変数名** | **説明** |
| --- | --- | --- |
| **攻めの重み** | `w_attack` | 手札を減らすことへの優先度。高いほど、出せる時は積極的にカードを出す。低いほどパスを選びやすくなる。 |
| **守りの重み** | `w_defense` | ペアや連続などの「強い形」を崩すことへの抵抗感。高いほど、セットを手札に残そうとする。 |
| **革命の好き度** | `w_revolution` | 革命を起こす、または革命状態を維持する手へのボーナス。高いほど革命を積極的に狙う。 |
| **切り札温存度合い** | `w_trump` | その状況での最強級カード（2やAなど）を温存する傾向。高いほど、序盤で最強カードを切るのを嫌がる。 |
| **ランダム性の強さ** | `epsilon` | 最適解以外の手を選ぶ確率、またはスコアに加算されるノイズの大きさ。高いほど予測不能な動き（ミス含む）をする。 |

## 3. キャラクター別パラメータ設定値 (プリセット)

| **キャラクター** | **攻め (w_attack)** | **守り (w_defense)** | **革命 (w_revolution)** | **温存 (w_trump)** | **ランダム (epsilon)** | **行動傾向** |
| --- | --- | --- | --- | --- | --- | --- |
| **椎奈** | **0.9** (高い) | 0.2 (低い) | 0.3 (低い) | 0.2 (低い) | **0.8** (高い) | 後先考えずにとにかくカードを出す。強いカードもすぐ使う。たまにポカをする。 |
| **佐紀** | 0.6 (標準) | 0.5 (標準) | **0.9** (高い) | 0.6 (標準) | 0.3 (低い) | 状況を見て革命を狙う戦略家。無駄打ちはしない。8切りも好む。 |
| **優花** | 0.3 (低い) | **0.8** (高い) | 0.5 (標準) | **0.9** (高い) | 0.1 (低い) | 堅実。パスを多用して手札を整える。最強カードを最後まで握りしめる。 |

## 4. 評価関数の仕様 (Evaluation Function)

各候補手 $Move_i$ のスコア $Score(Move_i)$ を以下の式で算出する。

### 基本式

$$Score(Move_i) = S_{base} + S_{impact} - S_{risk} + S_{bonus}$$

### 4.1. 各項目の計算ロジック

### A. 基本スコア ($S_{base}$)

カードを出すこと自体の価値。

- **出す場合:** $+100 \times w_{attack}$
- **パスの場合:** $+0$ (ただし、手札枚数が多い場合はマイナス補正がかかる場合あり)

### B. インパクトボーナス ($S_{impact}$)

場に出すカードの強さと枚数による加点。

- **カードの強さ:** (場に出すカードの平均強さ 0~12) $\times 5$
- **枚数:** (出す枚数 - 1) $\times 20$
- **8切り発動:** $+50 \times (w_{attack} + w_{defense})$ ※8切りは攻防一体のため

### C. リスク・コスト ($S_{risk}$)

手札を崩す、あるいは切り札を消費することへのペナルティ。

- **切り札消費:** もし出すカードがその時点で最強ランク(2など)の場合
    - $Penalty = 100 \times w_{trump} \times (1.0 - \text{終盤度係数})$
    - ※終盤(手札が少ない)ならペナルティは軽くなる。
- **ペア崩し:** 元々ペアだったカードを単体で出す場合
    - $Penalty = 60 \times w_{defense}$

### D. 特殊ボーナス ($S_{bonus}$)

- **革命:** もしその手で革命が起きる場合
    - $Bonus = 150 \times w_{revolution}$
- **あがり:** もしその手で手札が0枚になる場合
    - $Bonus = 10000$ (最優先)

## 5. 意思決定プロセス (Decision Making)

1. **候補手の生成:** 出せる手（パス含む）をリスト化。
2. **スコア計算:** 上記計算式で全候補手のスコアを計算。
3. **ノイズ付与 (ランダム性):**
    - 各スコアに $Random(-1, 1) \times 50 \times epsilon$ のノイズを加える。
    - ※椎奈のようなキャラはここで順位が入れ替わりやすくなる。
4. **選択:** 最もスコアが高い手を選択して実行する。

## 6. 特殊ケースの対応

### 大富豪・富豪のカード交換ロジック

ゲーム開始前のカード交換においても、このパラメータを応用する。

- **渡すカードの選定 (勝者側):**
    - **優花型 (温存高/攻め低):** 不要なカード（最も弱いカード）を素直に渡す。
    - **佐紀型 (革命高/ランダム低):** 基本は弱カードだが、相手の手札状況（不明だが）を撹乱するために、あえて中途半端なカード（10やJなど）を渡すロジックを微量に混ぜる。
    - **椎奈型 (ランダム高):** 割と適当に選ぶ（弱いカードを渡そうとして間違えて強いのを渡す確率はさすがに低くするが、`epsilon` で揺らぐ）。